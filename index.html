<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø´Ø±Ø© Ù…Ù‡Ø¯ÙŠ - Ù…Ø¯ÙˆÙ†Ø© Ø·Ø§Ù‡Ø± Ù…Ù‡Ø¯ÙŠ</title>
    <meta name="description" content="Ù…Ø¯ÙˆÙ†Ø© Ø·Ø§Ù‡Ø± Ù…Ù‡Ø¯ÙŠØŒ Ù…Ø¤Ø³Ø³ Ø´Ø±ÙƒØ© Happy SST Ø§Ù„Ù…Ø§Ù„ÙƒØ© Ù„Ø®Ø¯Ù…Ø© Happy Eats.">
    <link rel="icon" type="image/png" href="https://i.ibb.co/Kp4GCB5b/image.png">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8fafc; color: #1e293b; }
        .navbar { background: #0f172a; box-shadow: 0 2px 20px rgba(15,23,42,0.1); position: sticky; top: 0; z-index: 1000; }
        .nav-content { max-width: 1200px; margin: 0 auto; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.8em; font-weight: 700; color: white; display: flex; align-items: center; gap: 15px; }
        .logo-image { height: 60px; width: auto; }
        .admin-btn { background: white; color: #0f172a; border: none; padding: 10px 25px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .hero { background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); color: white; padding: 80px 40px; text-align: center; }
        .hero h1 { font-size: 3em; margin-bottom: 20px; }
        .hero p { font-size: 1.15em; line-height: 1.8; margin-bottom: 15px; }
        .company-badge { display: inline-block; background: rgba(255,255,255,0.2); padding: 12px 30px; border-radius: 50px; margin-top: 20px; font-weight: 600; }
        .container { max-width: 1200px; margin: 0 auto; padding: 60px 40px; }
        .admin-panel { background: white; border-radius: 16px; padding: 40px; margin-bottom: 60px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: none; }
        .admin-panel.active { display: block; }
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #0f172a; }
        input, textarea { width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; font-family: inherit; }
        textarea { min-height: 200px; resize: vertical; }
        .image-preview { margin-top: 15px; max-width: 100%; border-radius: 10px; display: none; }
        .image-preview.active { display: block; }
        .publish-btn { background: #0f172a; color: white; border: none; padding: 15px 40px; border-radius: 10px; font-size: 18px; font-weight: 600; cursor: pointer; width: 100%; }
        .article { background: white; border-radius: 16px; padding: 50px; margin-bottom: 40px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .article h3 { font-size: 2em; color: #0f172a; margin-bottom: 15px; }
        .article-image { width: 100%; max-height: 500px; object-fit: cover; border-radius: 12px; margin-bottom: 25px; }
        .article-meta { color: #64748b; font-size: 0.95em; margin-bottom: 25px; }
        .article-content { color: #475569; line-height: 1.9; font-size: 1.1em; margin-bottom: 30px; white-space: pre-wrap; }
        .views-count { display: inline-flex; align-items: center; gap: 8px; margin-right: 15px; }
        .article-actions { display: flex; gap: 10px; margin-top: 15px; }
        .edit-btn, .delete-btn { padding: 8px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .edit-btn { background: #3b82f6; color: white; }
        .delete-btn { background: #ef4444; color: white; }
        .comments-section { border-top: 2px solid #e2e8f0; padding-top: 30px; margin-top: 30px; }
        .comment { background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 15px; border-right: 4px solid #1e3a8a; }
        .comment-author { font-weight: 600; color: #0f172a; }
        .comment-input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0; }
        .comment-btn { background: #1e3a8a; color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 40px; border-radius: 16px; max-width: 400px; width: 90%; }
        .login-btn, .cancel-btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 10px; }
        .login-btn { background: #0f172a; color: white; }
        .cancel-btn { background: #e2e8f0; color: #0f172a; }
        .loading { text-align: center; padding: 40px; color: #64748b; }
        .footer { background: #0f172a; color: white; text-align: center; padding: 30px 20px; margin-top: 60px; }
        .close-admin { background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo">
                <img src="https://i.ibb.co/Kp4GCB5b/image.png" alt="Ù†Ø´Ø±Ø© Ù…Ù‡Ø¯ÙŠ" class="logo-image">
                Ù†Ø´Ø±Ø© Ù…Ù‡Ø¯ÙŠ
            </div>
            <button class="admin-btn" id="adminBtn">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
        </div>
    </nav>

    <section class="hero">
        <div style="max-width: 800px; margin: 0 auto;">
            <h1>Ø·Ø§Ù‡Ø± Ù…Ù‡Ø¯ÙŠ - Ù…Ø¤Ø³Ø³ ÙˆØ±Ø§Ø¦Ø¯ Ø£Ø¹Ù…Ø§Ù„</h1>
            <p>Ù…Ø¯ÙˆÙ†ØªÙŠ ÙÙŠ Ø±ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„Ø§Ø¨ØªÙƒØ§Ø±. Ø£Ø´Ø§Ø±Ùƒ ØªØ¬Ø±Ø¨ØªÙŠ ÙƒÙ…Ø¤Ø³Ø³ Ø´Ø±ÙƒØ© Happy SST Ø§Ù„Ù…Ø§Ù„ÙƒØ© Ù„Ø®Ø¯Ù…Ø© Happy Eats.</p>
            <div class="company-badge">Ø·Ø§Ù‡Ø± Ù…Ù‡Ø¯ÙŠ | Ù…Ø¤Ø³Ø³ Happy SST ğŸš€</div>
        </div>
    </section>

    <div class="container">
        <div id="adminPanel" class="admin-panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 id="panelTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯</h2>
                <button class="close-admin" id="closeAdminBtn">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
            <input type="hidden" id="editArticleId">
            <div class="form-group">
                <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„</label>
                <input type="text" id="articleTitle">
            </div>
            <div class="form-group">
                <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„ (1200Ã—675 Ø¨ÙƒØ³Ù„)</label>
                <input type="file" id="articleImage" accept="image/*">
                <img id="imagePreview" class="image-preview">
            </div>
            <div class="form-group">
                <label>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø§Ù„</label>
                <textarea id="articleContent"></textarea>
            </div>
            <button class="publish-btn" id="publishBtn">Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„</button>
        </div>

        <section>
            <h2 style="font-size: 2.5em; color: #0f172a; margin-bottom: 40px; text-align: center;">Ø¢Ø®Ø± Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</h2>
            <div id="articlesContainer"><div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª...</div></div>
        </section>
    </div>

    <footer class="footer">
        <p>Â© 2024 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø·Ø§Ù‡Ø± Ù…Ù‡Ø¯ÙŠ</p>
    </footer>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
            <div class="form-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="adminPassword">
            </div>
            <button class="login-btn" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
            <button class="cancel-btn" id="cancelBtn">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, orderBy, increment } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBHn2iKNya5Jz-VcNBHqx-Lyc50mQ-C-3E",
            authDomain: "nashrat-mehdi.firebaseapp.com",
            projectId: "nashrat-mehdi",
            storageBucket: "nashrat-mehdi.firebasestorage.app",
            messagingSenderId: "812636896982",
            appId: "1:812636896982:web:e61aecd8681962647dd377"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let isAdmin = false;

        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function openLogin() {
            document.getElementById('loginModal').classList.add('active');
        }

        function closeLogin() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('adminPassword').value = '';
        }

        function checkPassword() {
            if (document.getElementById('adminPassword').value === 'admin123') {
                isAdmin = true;
                closeLogin();
                document.getElementById('adminPanel').classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                loadArticles();
            } else {
                alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('editArticleId').value = '';
            document.getElementById('panelTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('articleTitle').value = '';
            document.getElementById('articleContent').value = '';
            document.getElementById('articleImage').value = '';
            document.getElementById('imagePreview').classList.remove('active');
        }

        function previewImage(event) {
            const preview = document.getElementById('imagePreview');
            const file = event.target.files[0];
            if (file) {
                // Ø¶ØºØ· Ø§Ù„ØµÙˆØ±Ø©
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        // ØªØµØºÙŠØ± Ø§Ù„Ø­Ø¬Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒØ¨ÙŠØ±
                        const maxSize = 1200;
                        if (width > height && width > maxSize) {
                            height = (height * maxSize) / width;
                            width = maxSize;
                        } else if (height > maxSize) {
                            width = (width * maxSize) / height;
                            height = maxSize;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Ø¶ØºØ· Ø¨Ø¬ÙˆØ¯Ø© 0.7
                        const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.7);
                        preview.src = compressedDataUrl;
                        preview.classList.add('active');
                        
                        // Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¶ØºÙˆØ·Ø©
                        preview.dataset.compressed = compressedDataUrl;
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        async function publishArticle() {
            const title = document.getElementById('articleTitle').value.trim();
            const content = document.getElementById('articleContent').value.trim();
            const imageFile = document.getElementById('articleImage').files[0];
            const editId = document.getElementById('editArticleId').value;

            if (!title || !content) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            const articleData = {
                title,
                content,
                date: new Date().toLocaleDateString('ar-DZ', { year: 'numeric', month: 'long', day: 'numeric' }),
                timestamp: new Date(),
                views: 0,
                comments: []
            };

            if (imageFile) {
                const preview = document.getElementById('imagePreview');
                const compressedImage = preview.dataset.compressed;
                
                if (compressedImage) {
                    articleData.image = compressedImage;
                    await saveArticle(articleData, editId);
                } else {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        // Ø¶ØºØ· Ø§Ù„ØµÙˆØ±Ø©
                        const img = new Image();
                        img.onload = async () => {
                            const canvas = document.createElement('canvas');
                            let width = img.width;
                            let height = img.height;
                            
                            const maxSize = 1200;
                            if (width > height && width > maxSize) {
                                height = (height * maxSize) / width;
                                width = maxSize;
                            } else if (height > maxSize) {
                                width = (width * maxSize) / height;
                                height = maxSize;
                            }
                            
                            canvas.width = width;
                            canvas.height = height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);
                            
                            articleData.image = canvas.toDataURL('image/jpeg', 0.7);
                            await saveArticle(articleData, editId);
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(imageFile);
                }
            } else {
                if (editId) {
                    const articles = await getDocs(collection(db, 'articles'));
                    const article = articles.docs.find(d => d.id === editId);
                    if (article?.data().image) articleData.image = article.data().image;
                }
                await saveArticle(articleData, editId);
            }
        }

        async function saveArticle(data, editId) {
            try {
                if (editId) {
                    await updateDoc(doc(db, 'articles', editId), data);
                    alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
                } else {
                    await addDoc(collection(db, 'articles'), data);
                    alert('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
                }
                closeAdminPanel();
                loadArticles();
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
            }
        }

        window.editArticle = async (id) => {
            if (!isAdmin) return alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ±');
            
            const articles = await getDocs(collection(db, 'articles'));
            const article = articles.docs.find(d => d.id === id)?.data();
            if (!article) return;

            document.getElementById('editArticleId').value = id;
            document.getElementById('articleTitle').value = article.title;
            document.getElementById('articleContent').value = article.content;
            document.getElementById('panelTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„';
            
            if (article.image) {
                document.getElementById('imagePreview').src = article.image;
                document.getElementById('imagePreview').classList.add('active');
            }

            document.getElementById('adminPanel').classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.deleteArticle = async (id) => {
            if (!isAdmin) return alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ±');
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø§Ù„ØŸ')) return;
            
            try {
                await deleteDoc(doc(db, 'articles', id));
                alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„');
                loadArticles();
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
            }
        };

        window.addComment = async (articleId) => {
            const name = document.getElementById(`name-${articleId}`).value.trim();
            const text = document.getElementById(`comment-${articleId}`).value.trim();

            if (!name || !text) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');

            try {
                const articles = await getDocs(collection(db, 'articles'));
                const articleDoc = articles.docs.find(d => d.id === articleId);
                if (!articleDoc) return;

                const article = articleDoc.data();
                const comments = article.comments || [];
                comments.push({
                    name,
                    text,
                    date: new Date().toLocaleDateString('ar-DZ', { year: 'numeric', month: 'long', day: 'numeric' })
                });

                await updateDoc(doc(db, 'articles', articleId), { comments });
                document.getElementById(`name-${articleId}`).value = '';
                document.getElementById(`comment-${articleId}`).value = '';
                loadArticles();
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message);
            }
        };

        window.incrementViews = async (articleId) => {
            const viewedArticles = JSON.parse(localStorage.getItem('viewedArticles') || '{}');
            const now = Date.now();
            
            if (!viewedArticles[articleId] || (now - viewedArticles[articleId]) > 300000) {
                try {
                    await updateDoc(doc(db, 'articles', articleId), { views: increment(1) });
                    viewedArticles[articleId] = now;
                    localStorage.setItem('viewedArticles', JSON.stringify(viewedArticles));
                } catch (error) {
                    console.error('Error incrementing views:', error);
                }
            }
        };

        async function loadArticles() {
            try {
                const q = query(collection(db, 'articles'), orderBy('timestamp', 'desc'));
                const snapshot = await getDocs(q);
                const container = document.getElementById('articlesContainer');

                if (snapshot.empty) {
                    container.innerHTML = '<div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø¨Ø¹Ø¯</div>';
                    return;
                }

                container.innerHTML = snapshot.docs.map(docSnap => {
                    const article = docSnap.data();
                    const id = docSnap.id;
                    return `
                        <article class="article" onmouseenter="incrementViews('${id}')">
                            <h3>${article.title}</h3>
                            <div class="article-meta">
                                ${article.date}
                                <span class="views-count">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    ${article.views || 0} Ù…Ø´Ø§Ù‡Ø¯Ø©
                                </span>
                            </div>
                            ${article.image ? `<img src="${article.image}" class="article-image">` : ''}
                            <div class="article-content">${article.content}</div>
                            ${isAdmin ? `
                                <div class="article-actions">
                                    <button class="edit-btn" onclick="editArticle('${id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                                    <button class="delete-btn" onclick="deleteArticle('${id}')">Ø­Ø°Ù</button>
                                </div>
                            ` : ''}
                            <div class="comments-section">
                                <h4 style="font-size: 1.5em; margin-bottom: 20px;">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (${(article.comments || []).length})</h4>
                                ${(article.comments || []).map(c => `
                                    <div class="comment">
                                        <div class="comment-author">${c.name}</div>
                                        <div style="font-size: 0.85em; color: #64748b; margin: 5px 0;">${c.date}</div>
                                        <div>${c.text}</div>
                                    </div>
                                `).join('')}
                                <h5 style="margin: 20px 0 15px;">Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ùƒ</h5>
                                <div class="comment-input-group">
                                    <input type="text" id="name-${id}" placeholder="Ø§Ø³Ù…Ùƒ">
                                    <input type="text" id="comment-${id}" placeholder="ØªØ¹Ù„ÙŠÙ‚Ùƒ">
                                </div>
                                <button class="comment-btn" onclick="addComment('${id}')">Ø¥Ø±Ø³Ø§Ù„</button>
                            </div>
                        </article>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading articles:', error);
                document.getElementById('articlesContainer').innerHTML = '<div class="loading">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</div>';
            }
        }

        // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.getElementById('adminBtn').onclick = openLogin;
        document.getElementById('loginBtn').onclick = checkPassword;
        document.getElementById('cancelBtn').onclick = closeLogin;
        document.getElementById('closeAdminBtn').onclick = closeAdminPanel;
        document.getElementById('publishBtn').onclick = publishArticle;
        document.getElementById('articleImage').onchange = previewImage;

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª
        loadArticles();
    </script>
</body>
</html>
